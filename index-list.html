<!DOCTYPE html>
<html>
<head>
    <!-- General -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>xplr.es - List</title>
    <meta name="description" content="Exploring forgotten, unknown, and unusual locations all around Europe.">
    <!-- Share Metadata -->
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://www.xplr.es/og.png"/>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <!-- Links -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="style-home.css">
</head>
<body>
    <header>
        <h1>xplr.es</h1>
        <div class="nav-buttons">
            <button onclick="window.location.href='index-grid.html';">Photos</button>
            <button onclick="window.location.href='index-list.html';" class="nav-button-active" >List</button>
            <button onclick="window.location.href='index-map.html';">Map</button>
        </div>
    </header>
    <div class="table-container">
        <table id="locationTable" class="display row-border">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Location</th>
                    <th>Country</th>
                    <th>Tags</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <img id="hoverImage" class="hover-image" src="" alt="">
    <script>
    async function loadTable() {
        const response = await fetch('pins-new.geojson');
        const data = await response.json();
        const tableData = data.features.map(feature => {
            return {
                id: feature.properties.id,
                title: feature.properties.title,
                location: feature.properties.location,
                country: feature.properties.country,
                tags: feature.properties.tags.join(', '),
                link: feature.properties.link,
                hero: feature.properties.image
            };
        }).sort((a, b) => b.id - a.id); // Sort newest to oldest

        const table = $('#locationTable').DataTable({
            data: tableData,
            order: [[0, 'desc']],
            searching: false,
            ordering: false,
            columns: [
                { data: 'id', width: '5%' },
                { 
                    data: 'title', 
                    width: 'auto', 
                    render: function(data, type, row) {
                        return `<span class="truncate-text" title="${data}">${data}</span>`;
                    }
                },
                { 
                    data: 'location', width: '15%', visible: window.innerWidth > 600 
                },
                { 
                    data: 'country', width: '15%', visible: window.innerWidth > 600 
                },
                { 
                    data: 'tags', width: '15%', visible: window.innerWidth > 600 
                }
            ],
            paging: false, // Remove pagination, show all rows
            className: 'row-border'
        });

        // Update column visibility on window resize
        window.addEventListener('resize', function() {
            let isMobile = window.innerWidth <= 600;
            table.column(2).visible(!isMobile);
            table.column(3).visible(!isMobile);
            table.column(4).visible(!isMobile);
        });
        window.addEventListener('resize', function() {
            let isMobile = window.innerWidth <= 800;
            table.column(2).visible(!isMobile);
            table.column(4).visible(!isMobile);
        });
        window.addEventListener('resize', function() {
            let isMobile = window.innerWidth <= 1000;
            table.column(4).visible(!isMobile);
        });

        // Function to detect if input is from a mouse
        function isMouseEvent(event) {
            return event.pointerType === 'mouse' || event.originalEvent.pointerType === 'mouse';
        }

        // Hover image functionality (only for mouse input)
        $('#locationTable tbody').on('pointerenter', 'tr', function (event) {
            if (!isMouseEvent(event)) return;
            
            const rowData = table.row(this).data();
            const hoverImage = document.getElementById('hoverImage');
            hoverImage.style.display = 'none'; // Instantly hide image before changing source
            hoverImage.src = rowData.hero;
            hoverImage.style.display = 'block';
        });

        $('#locationTable tbody').on('pointermove', 'tr', function (event) {
            if (!isMouseEvent(event)) return;
            
            const hoverImage = document.getElementById('hoverImage');
            hoverImage.style.left = event.pageX + 20 + 'px';
            hoverImage.style.top = event.pageY + 20 + 'px';
        });

        $('#locationTable tbody').on('pointerleave', 'tr', function (event) {
            if (!isMouseEvent(event)) return;
            
            document.getElementById('hoverImage').style.display = 'none';
        });
    }

    loadTable();
    </script>
</body>
</html>
